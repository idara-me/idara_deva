(()=>{var v=class{constructor({doctype:e}){e||frappe.throw(__("Doctype required")),this.doctype=e}print(e){let t=frappe.model.get_doc(":Print Settings","Print Settings"),s=cint(t.allow_print_for_draft),i=frappe.model.is_submittable(this.doctype),l=cint(t.allow_print_for_cancelled),r=this.get_letterhead_options(),a=500,_=e.filter(n=>!i||n.docstatus===1||l&&n.docstatus==2||s&&n.docstatus==0||frappe.user.has_role("Administrator")).map(n=>n.name);if(e.filter(n=>!_.includes(n.name)).length>0){frappe.msgprint(__("You selected Draft or Cancelled documents"));return}if(_.length===0){frappe.msgprint(__("Select atleast 1 record for printing"));return}if(_.length>a){frappe.msgprint(__("You can only print upto {0} documents at a time",[a]));return}let o=new frappe.ui.Dialog({title:__("Print Documents"),fields:[{fieldtype:"Select",label:__("Letter Head"),fieldname:"letter_sel",options:r,default:r[0]},{fieldtype:"Select",label:__("Print Format"),fieldname:"print_sel",options:frappe.meta.get_print_formats(this.doctype),default:frappe.get_meta(this.doctype).default_print_format},{fieldtype:"Select",label:__("Page Size"),fieldname:"page_size",options:frappe.meta.get_print_sizes(),default:t.pdf_page_size},{fieldtype:"Float",label:__("Page Height (in mm)"),fieldname:"page_height",depends_on:'eval:doc.page_size == "Custom"',default:t.pdf_page_height},{fieldtype:"Float",label:__("Page Width (in mm)"),fieldname:"page_width",depends_on:'eval:doc.page_size == "Custom"',default:t.pdf_page_width}]});o.set_primary_action(__("Print"),n=>{if(!n)return;let p=frappe.get_meta(this.doctype).default_print_format,u=n.letter_sel==__("No Letterhead")?0:1,g=n.print_sel?n.print_sel:p,w=JSON.stringify(_),c=n.letter_sel,f;n.page_size==="Custom"?((n.page_height===0||n.page_width===0)&&frappe.throw(__("Page height and width cannot be zero")),f=JSON.stringify({"page-height":n.page_height,"page-width":n.page_width})):f=JSON.stringify({"page-size":n.page_size}),frappe.call("frappe.utils.print_format.download_multi_pdf_async",{doctype:this.doctype,name:w,format:g,no_letterhead:u?"0":"1",letterhead:c,options:f}).then(b=>{let m=b.message.task_id;frappe.realtime.task_subscribe(m),frappe.realtime.on(`task_complete:${m}`,x=>{frappe.msgprint({title:__("Bulk PDF Export"),message:__("Your PDF is ready for download"),primary_action:{label:__("Download PDF"),client_action:"window.open",args:x.file_url}}),frappe.realtime.task_unsubscribe(m),frappe.realtime.off(`task_complete:${m}`)}),o.hide()})}),o.show()}get_letterhead_options(){let e=[__("No Letterhead")];return frappe.call({method:"frappe.client.get_list",args:{doctype:"Letter Head",fields:["name","is_default"],filters:{disabled:0},limit_page_length:0},async:!1,callback(t){t.message&&t.message.forEach(s=>{s.is_default?e.unshift(s.name):e.push(s.name)})}}),e}delete(e,t=null){frappe.call({method:"frappe.desk.reportview.delete_items",freeze:!0,freeze_message:e.length<=10?__("Deleting {0} records...",[e.length]):null,args:{items:e,doctype:this.doctype}}).then(s=>{let i=s.message;i||(i=[]),i.length&&!s._server_messages&&frappe.throw(__("Cannot delete {0}",[i.map(l=>l.bold()).join(", ")])),i.length<e.length&&(frappe.utils.play_sound("delete"),t&&t())})}assign(e,t){if(e.length>0){let s=new frappe.ui.form.AssignToDialog({obj:this,method:"frappe.desk.form.assign_to.add_multiple",doctype:this.doctype,docname:e,bulk_assign:!0,re_assign:!0,callback:t});s.dialog.clear(),s.dialog.show()}else frappe.msgprint(__("Select records for assignment"))}apply_assignment_rule(e,t){e.length>0&&frappe.call("frappe.automation.doctype.assignment_rule.assignment_rule.bulk_apply",{doctype:this.doctype,docnames:e}).then(()=>t())}submit_or_cancel(e,t="submit",s=null){t=t.toLowerCase();let i=Math.random().toString(36).slice(-5);return frappe.realtime.task_subscribe(i),frappe.xcall("frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs",{doctype:this.doctype,action:t,docnames:e,task_id:i}).then(l=>{if(l!=null&&l.length){let r=frappe.utils.comma_and(l);switch(t){case"submit":frappe.throw(__("Cannot submit {0}.",[r]));break;case"cancel":frappe.throw(__("Cannot cancel {0}.",[r]));break;default:frappe.throw(__("Cannot {0} {1}.",[t,r]))}}(l==null?void 0:l.length)<e.length&&(frappe.utils.play_sound(t),s&&s())}).finally(()=>{frappe.realtime.task_unsubscribe(i)})}edit(e,t,s){let i=Object.keys(t).sort(function(o,n){return __(cstr(t[o].label)).localeCompare(cstr(__(t[n].label)))}),l=/status/i,r=i.find(o=>l.test(o)),a=new frappe.ui.Dialog({title:__("Bulk Edit"),fields:[{fieldtype:"Select",options:i,default:r,label:__("Field"),fieldname:"field",reqd:1,onchange:()=>{_(a)}},{fieldtype:"Data",label:__("Value"),fieldname:"value",onchange(){d()}}],primary_action:({value:o})=>{let n=t[a.get_value("field")].fieldname;a.disable_primary_action(),frappe.call({method:"frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs",args:{doctype:this.doctype,freeze:!0,docnames:e,action:"update",data:{[n]:o||null}}}).then(p=>{let u=p.message||[];u.length&&!p._server_messages&&(a.enable_primary_action(),frappe.throw(__("Cannot update {0}",[u.map(g=>g.bold?g.bold():g).join(", ")]))),s(),a.hide(),frappe.show_alert(__("Updated successfully"))})},primary_action_label:__("Update {0} records",[e.length])});r&&_(a),d();function _(o){let n=Object.assign({},t[o.get_value("field")]);if(n.label.match(l)&&n.fieldtype==="Select"&&!n.default){let p=[];typeof n.options=="string"&&(p=n.options.split(`
`)),n.default=p[0]||p[1]}n.label=__("Value"),n.onchange=d,delete n.depends_on,o.replace_field("value",n),d()}function d(){let o=a.get_value("value");o==null||o===""?a.set_df_property("value","description",__("You have not entered a value. The field will be set to empty.")):a.set_df_property("value","description","")}a.refresh(),a.show()}add_tags(e,t){let s=new frappe.ui.Dialog({title:__("Add Tags"),fields:[{fieldtype:"MultiSelectPills",fieldname:"tags",label:__("Tags"),reqd:!0,get_data:function(i){return frappe.db.get_link_options("Tag",i)}}],primary_action_label:__("Add"),primary_action:()=>{let i=s.get_values();i&&i.tags&&(s.set_message("Adding Tags..."),frappe.call({method:"frappe.desk.doctype.tag.tag.add_tags",args:{tags:i.tags,dt:this.doctype,docs:e},callback:()=>{s.hide(),t()}}))}});s.show()}export(e,t){frappe.require("data_import_tools.bundle.js",()=>{let s=new frappe.data_import.DataExporter(e,"Insert New Records");s.dialog.set_value("export_records","by_filter"),s.filter_group.add_filters_to_filter_group([[e,"name","in",t,!1]])})}};var y=class{constructor({listview:e,doctype:t,meta:s,settings:i}){t||frappe.throw("DocType required"),this.listview=e,this.doctype=t,this.meta=s,this.settings=i,this.dialog=null,this.fields=this.settings&&this.settings.fields?JSON.parse(this.settings.fields):[],this.subject_field=null,frappe.model.with_doctype("List View Settings",()=>{this.make(),this.get_listview_fields(s),this.setup_fields(),this.setup_remove_fields(),this.add_new_fields(),this.show_dialog()})}make(){let e=this,t=frappe.get_meta("List View Settings");e.dialog=new frappe.ui.Dialog({title:__("{0} Settings",[__(e.doctype)]),fields:t.fields}),e.dialog.set_values(e.settings),e.dialog.set_primary_action(__("Save"),()=>{let s=e.dialog.get_values();frappe.show_alert({message:__("Saving"),indicator:"green"}),frappe.call({method:"frappe.desk.doctype.list_view_settings.list_view_settings.save_listview_settings",args:{doctype:e.doctype,listview_settings:s,removed_listview_fields:e.removed_fields||[]},callback:function(i){e.listview.refresh_columns(i.message.meta,i.message.listview_settings),e.dialog.hide()}})}),e.dialog.fields_dict.total_fields.df.onchange=()=>e.refresh()}refresh(){let e=this;e.setup_fields(),e.add_new_fields(),e.setup_remove_fields()}show_dialog(){let e=this;if(this.settings.fields||e.update_fields(),!e.dialog.get_value("total_fields")){let t=e.fields.length;t<4?t=4:t>10&&(t=10),e.dialog.set_value("total_fields",t)}e.dialog.show()}setup_fields(){function e(a){return a.fieldname==="status_field"}let t=this,s=t.dialog.get_field("fields_html"),i=s.$wrapper[0],l="",r=t.dialog.get_values().total_fields||t.settings.total_fields;for(let a in t.fields){if(a==parseInt(r))break;let _=a==0?"":"sortable",d=a==0?"hide":"",o=a==0||e(t.fields[a])?"hide":"";l+=`
				<div class="control-input flex align-center form-control fields_order ${_}"
					style="display: block; margin-bottom: 5px;" data-fieldname="${t.fields[a].fieldname}"
					data-label="${t.fields[a].label}" data-type="${t.fields[a].type}">

					<div class="row">
						<div class="col-1">
							${frappe.utils.icon("drag","xs","","","sortable-handle "+d)}
						</div>
						<div class="col-10" style="padding-left:0px;">
							${__(t.fields[a].label,null,t.doctype)}
						</div>
						<div class="col-1 ${o}">
							<a class="text-muted remove-field" data-fieldname="${t.fields[a].fieldname}">
								${frappe.utils.icon("delete","xs")}
							</a>
						</div>
					</div>
				</div>`}s.html(`
			<div class="form-group">
				<div class="clearfix">
					<label class="control-label" style="padding-right: 0px;">${__("Fields")}</label>
				</div>
				<div class="control-input-wrapper">
				${l}
				</div>
				<p class="help-box small text-muted">
					<a class="add-new-fields text-muted">
						${__("+ Add / Remove Fields")}
					</a>
				</p>
			</div>
		`),new Sortable(i.getElementsByClassName("control-input-wrapper")[0],{handle:".sortable-handle",draggable:".sortable",onUpdate:()=>{t.update_fields(),t.refresh()}})}add_new_fields(){let e=this,s=e.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("add-new-fields")[0];s.onclick=()=>e.column_selector()}setup_remove_fields(){let e=this,s=e.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("remove-field");for(let i=0;i<s.length;i++)s.item(i).onclick=()=>e.remove_fields(s.item(i).getAttribute("data-fieldname"))}remove_fields(e){let t=this,s=t.fields.map(i=>i.fieldname);for(let i in t.fields)if(t.fields[i].fieldname==e){t.fields.splice(i,1);break}t.set_removed_fields(t.get_removed_listview_fields(t.fields.map(i=>i.fieldname),s)),t.refresh(),t.update_fields()}update_fields(){let e=this,i=e.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("fields_order");e.fields=[];for(let l=0;l<i.length;l++)e.fields.push({fieldname:i.item(l).getAttribute("data-fieldname"),label:__(i.item(l).getAttribute("data-label"))});e.dialog.set_value("fields",JSON.stringify(e.fields)),e.dialog.get_value("fields")}column_selector(){let e=this,t=new frappe.ui.Dialog({title:__("{0} Fields",[__(e.doctype)]),fields:[{label:__("Reset Fields"),fieldtype:"Button",fieldname:"reset_fields",click:()=>e.reset_listview_fields(t)},{label:__("Select Fields"),fieldtype:"MultiCheck",fieldname:"fields",options:e.get_doctype_fields(e.meta,e.fields.map(s=>s.fieldname)),columns:2}]});t.set_primary_action(__("Save"),()=>{let s=t.get_values().fields;e.set_removed_fields(e.get_removed_listview_fields(s,e.fields.map(i=>i.fieldname))),e.fields=[],e.set_subject_field(e.meta),e.set_status_field();for(let i in s){let l=s[i];if(e.fields.length===parseInt(e.dialog.get_values().total_fields))break;if(l!=e.subject_field.fieldname){let r=frappe.meta.get_docfield(e.doctype,l);r&&e.fields.push({label:__(r.label,null,e.doctype),fieldname:r.fieldname})}}e.refresh(),e.dialog.set_value("fields",JSON.stringify(e.fields)),t.hide()}),t.show()}reset_listview_fields(e){let t=this;frappe.xcall("frappe.desk.doctype.list_view_settings.list_view_settings.get_default_listview_fields",{doctype:t.doctype}).then(s=>{let i=e.get_field("fields");i.df.options=t.get_doctype_fields(t.meta,s),e.refresh()})}get_listview_fields(e){let t=this;t.settings.fields?t.fields=JSON.parse(this.settings.fields):t.set_list_view_fields(e),t.fields.uniqBy(s=>s.fieldname)}set_list_view_fields(e){let t=this;t.set_subject_field(e),t.set_status_field(),e.fields.forEach(s=>{s.in_list_view&&!frappe.model.no_value_type.includes(s.fieldtype)&&t.subject_field.fieldname!=s.fieldname&&t.fields.push({label:__(s.label,null,t.doctype),fieldname:s.fieldname})})}set_subject_field(e){let t=this;if(t.subject_field={label:__("ID"),fieldname:"name"},e.title_field){let s=frappe.meta.get_docfield(t.doctype,e.title_field.trim());t.subject_field={label:__(s.label,null,t.doctype),fieldname:s.fieldname}}t.fields.push(t.subject_field)}set_status_field(){let e=this;frappe.has_indicator(e.doctype)&&e.fields.push({type:"Status",label:__("Status"),fieldname:"status_field"})}get_doctype_fields(e,t){let s=[];return e.fields.forEach(i=>{frappe.model.no_value_type.includes(i.fieldtype)||s.push({label:__(i.label,null,i.doctype),value:i.fieldname,checked:t.includes(i.fieldname)})}),s}get_removed_listview_fields(e,t){let s=this,i=[];return frappe.has_indicator(s.doctype)&&e.push("status_field"),t.forEach(l=>{e.includes(l)||i.push(l)}),i}set_removed_fields(e){let t=this;t.removed_fields?t.removed_fields=t.removed_fields.concat(e):t.removed_fields=e}};frappe.provide("frappe.views");frappe.views.ListView=class extends frappe.views.BaseList{static load_last_view(){let e=frappe.get_route(),t=e[1];if(e.length===2){let i=frappe.get_user_settings(t).last_view;return frappe.set_route("list",frappe.router.doctype_layout||t,frappe.views.is_valid(i)?i.toLowerCase():"list"),!0}return!1}constructor(e){console.log("custom List view"),super(e),this.show(),this.debounced_refresh=frappe.utils.debounce(this.process_document_refreshes.bind(this),2e3),this.count_upper_bound=1001,this._element_factory=new k(this.doctype)}has_permissions(){return frappe.perm.has_perm(this.doctype,0,"read")}show(){this.parent.disable_scroll_to_top=!0,super.show()}check_permissions(){this.has_permissions()||(frappe.set_route(""),frappe.throw(__("Not permitted to view {0}",[this.doctype])))}show_skeleton(){this.$list_skeleton=this.parent.page.container.find(".list-skeleton"),this.$list_skeleton.length||(this.$list_skeleton=$(`
				<div class="row list-skeleton">
					<div class="col-lg-2">
						<div class="list-skeleton-box"></div>
					</div>
					<div class="col">
						<div class="list-skeleton-box"></div>
					</div>
				</div>
			`),this.parent.page.container.find(".page-content").append(this.$list_skeleton)),this.parent.page.container.find(".layout-main").hide(),this.$list_skeleton.show()}hide_skeleton(){this.$list_skeleton&&this.$list_skeleton.hide(),this.parent.page.container.find(".layout-main").show()}get view_name(){return"List"}get view_user_settings(){return this.user_settings[this.view_name]||{}}setup_defaults(){if(super.setup_defaults(),this.view="List",this.sort_by=this.view_user_settings.sort_by||this.sort_by||"modified",this.sort_order=this.view_user_settings.sort_order||this.sort_order||"desc",this.menu_items=this.menu_items.concat(this.get_menu_items()),Array.isArray(this.view_user_settings.filters)){let e=this.view_user_settings.filters;this.filters=this.validate_filters(e)}else this.filters=(this.settings.filters||[]).map(e=>(e.length===3&&(e=[this.doctype,e[0],e[1],e[2]]),e));return this.view_name=="List"&&(this.toggle_paging=!0),this.patch_refresh_and_load_lib(),this.get_list_view_settings()}on_sort_change(e,t){this.sort_by=e,this.sort_order=t,super.on_sort_change()}validate_filters(e){let t=this.meta.fields.map(s=>s.fieldname);return t=t.concat(frappe.model.std_fields_list),e.filter(s=>t.includes(s[1])).uniqBy(s=>s[1])}setup_page(){this.parent.list_view=this,super.setup_page()}setup_page_head(){super.setup_page_head(),this.set_primary_action(),this.set_actions_menu_items()}set_actions_menu_items(){this.actions_menu_items=this.get_actions_menu_items(),this.workflow_action_menu_items=this.get_workflow_action_menu_items(),this.workflow_action_items={},this.actions_menu_items.concat(this.workflow_action_menu_items).forEach(t=>{let s=this.page.add_actions_menu_item(t.label,t.action,t.standard);t.class&&s.addClass(t.class),t.is_workflow_action&&s&&(this.workflow_action_items[t.name]=s)})}show_restricted_list_indicator_if_applicable(){let e=frappe.perm.get_match_rules(this.doctype);e.length&&(this.restricted_list=$(`<button class="btn btn-xs restricted-button flex align-center">
					${frappe.utils.icon("restriction","xs")}
				</button>`).click(()=>this.show_restrictions(e)).appendTo(this.page.page_form))}show_restrictions(e=[]){frappe.msgprint(frappe.render_template("list_view_permission_restrictions",{condition_list:e}),__("Restrictions",null,"Title of message showing restrictions in list view"))}get_fields(){return super.get_fields().concat(Object.entries(this.link_field_title_fields||{}).map(e=>e.join(".")+" as "+e.join("_")))}async set_fields(){this.link_field_title_fields={};let e=[].concat(frappe.model.std_fields_list,this.get_fields_in_list_view(),[this.meta.title_field,this.meta.image_field],this.settings.add_fields||[],this.meta.track_seen?"_seen":null,this.sort_by,"enabled","disabled","color");await Promise.all(e.map(t=>new Promise(s=>{let i=typeof t=="string"?frappe.meta.get_docfield(this.doctype,t):t;i&&i.fieldtype=="Link"&&frappe.boot.link_title_doctypes.includes(i.options)?frappe.model.with_doctype(i.options,()=>{let l=frappe.get_meta(i.options);l.show_title_field_in_link&&(this.link_field_title_fields[typeof t=="string"?t:t.fieldname]=l.title_field),this._add_field(t),s()}):(this._add_field(t),s())}))),this.fields.forEach(t=>{let s=frappe.meta.get_docfield(t[1],t[0]);s&&s.fieldtype==="Currency"&&s.options&&!s.options.includes(":")&&this._add_field(s.options)})}patch_refresh_and_load_lib(){this.refresh=this.refresh.bind(this),this.refresh=frappe.utils.throttle(this.refresh,1e3),this.load_lib=new Promise(t=>{this.required_libs?frappe.require(this.required_libs,t):t()});let e=5*60*1e3;setInterval(()=>{frappe.get_route_str()===this.page_name&&this.refresh()},e)}set_primary_action(){if(this.can_create&&!frappe.boot.read_only){let e=__(frappe.router.doctype_layout)||__(this.doctype),t=`${__("Add",null,"Primary action in list view")} ${e}`;this.page.set_primary_action(t,()=>{this.settings.primary_action?this.settings.primary_action():this.make_new_doc()},"add")}else this.page.clear_primary_action()}make_new_doc(){let e=this.doctype,t={};this.filter_area.get().forEach(s=>{s[2]==="="&&frappe.model.is_non_std_field(s[1])&&(t[s[1]]=s[3])}),frappe.new_doc(e,t)}setup_view(){this.setup_columns(),this.render_header(),this.render_skeleton(),this.setup_events(),this.settings.onload&&this.settings.onload(this),this.show_restricted_list_indicator_if_applicable()}refresh_columns(e,t){this.meta=e,this.list_view_settings=t,this.setup_columns(),this.refresh(!0)}refresh(e=!1){return super.refresh().then(()=>{this.render_header(e),this.update_checkbox(),this.update_url_with_filters(),this.setup_realtime_updates()})}update_checkbox(e){if(!this.$checkbox_actions)return;let t=this.$checkbox_actions.find(".list-check-all");t.prop("checked")&&e&&!e.prop("checked")&&t.prop("checked",!1),t.prop("checked",this.$checks.length===this.data.length)}setup_freeze_area(){this.$freeze=$(`<div class="freeze flex justify-center align-center text-muted">
				${__("Loading")}...
			</div>`).hide(),this.$result.append(this.$freeze)}setup_columns(){this.columns=[];let e=frappe.meta.get_docfield.bind(null,this.doctype);this.meta.title_field?this.columns.push({type:"Subject",df:e(this.meta.title_field)}):this.columns.push({type:"Subject",df:{label:__("ID"),fieldname:"name"}}),this.columns.push({type:"Tag"}),frappe.has_indicator(this.doctype)&&this.columns.push({type:"Status"});let t=this.get_fields_in_list_view();this.columns=this.columns.concat(t.filter(i=>frappe.has_indicator(this.doctype)&&i.fieldname==="status"||!i.in_list_view||i.is_virtual?!1:i.fieldname!==this.meta.title_field).map(i=>({type:"Field",df:i}))),this.list_view_settings.fields&&(this.columns=this.reorder_listview_fields());let s=6;window.innerWidth<=1366?s=4:window.innerWidth>=1920&&(s=10),this.columns=this.columns.slice(0,this.list_view_settings.total_fields||s),!this.settings.hide_name_column&&this.meta.title_field&&this.meta.title_field!=="name"&&this.columns.push({type:"Field",df:{label:__("ID"),fieldname:"name"}})}reorder_listview_fields(){let e=[],t=JSON.parse(this.list_view_settings.fields);e.push(this.columns[0]),e.push(this.columns[1]),this.columns.splice(0,2);for(let s in t)for(let i in this.columns){let l=t[s],r=this.columns[i];if(r.type=="Status"&&l.fieldname=="status_field"){e.push(r);break}else if(r.type=="Field"&&l.fieldname===r.df.fieldname){e.push(r);break}}return e}get_documentation_link(){return this.meta.documentation?`<a href="${this.meta.documentation}" target="blank" class="meta-description small text-muted">Need Help?</a>`:""}get_no_result_message(){let e=this.get_documentation_link(),t=this.filter_area&&this.filter_area.get(),s=t&&t.length,i=s?__("No {0} found with matching filters. Clear filters to see all {0}.",[__(this.doctype)]):this.meta.description?__(this.meta.description):__("You haven't created a {0} yet",[__(this.doctype)]),l=s?__("Create a new {0}",[__(this.doctype)],"Create a new document from list view"):__("Create your first {0}",[__(this.doctype)],"Create a new document from list view"),r=this.settings.empty_state_image||"/assets/frappe/images/ui-states/list-empty-state.svg",a=this.can_create?`<p><button class="btn btn-default btn-sm btn-new-doc hidden-xs">
				${l}
			</button> <button class="btn btn-primary btn-new-doc visible-xs">
				${__("Create New",null,"Create a new document from list view")}
			</button></p>`:"";return`<div class="msg-box no-border">
			<div>
				<img src="${r}" alt="Generic Empty State" class="null-state">
			</div>
			<p>${i}</p>
			${a}
			${e}
		</div>`}freeze(){this.list_view_settings&&!this.list_view_settings.disable_count&&this.get_count_element().html(`<span>${__("Refreshing",null,"Document count in list view")}...</span>`)}get_args(){let e=super.get_args();return this.list_view_settings&&!this.list_view_settings.disable_comment_count?e.with_comment_count=1:e.with_comment_count=0,e}before_refresh(){return frappe.route_options&&this.filter_area&&(this.filters=this.parse_filters_from_route_options(),frappe.route_options=null,this.filters.length>0)?this.filter_area.clear(!1).then(()=>this.filter_area.set(this.filters)):Promise.resolve()}parse_filters_from_settings(){return(this.settings.filters||[]).map(e=>(e.length===3&&(e=[this.doctype,e[0],e[1],e[2]]),e))}toggle_result_area(){super.toggle_result_area(),this.toggle_actions_menu_button(this.$result.find(".list-row-check:checked").length>0)}toggle_actions_menu_button(e){e?(this.page.show_actions_menu(),this.page.clear_primary_action()):(this.page.hide_actions_menu(),this.set_primary_action())}render_header(e=!1){e&&this.$result.find(".list-row-head").remove(),this.$result.find(".list-row-head").length===0&&this.$result.prepend(this.get_header_html())}render_skeleton(){let e=this.get_list_row_html_skeleton('<div><input type="checkbox" class="render-list-checkbox"/></div>');this.$result.append(e)}before_render(){this.settings.before_render&&this.settings.before_render(),frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.save_view_user_settings({filters:this.filter_area&&this.filter_area.get(),sort_by:this.sort_selector&&this.sort_selector.sort_by,sort_order:this.sort_selector&&this.sort_selector.sort_order}),this.toggle_paging&&this.$paging_area.toggle(!1)}after_render(){this.$no_result.html(`
			<div class="no-result text-muted flex justify-center align-center">
				${this.get_no_result_message()}
			</div>
		`),this.setup_new_doc_event(),this.toggle_paging&&this.$paging_area.toggle(!0)}render(){this.render_list(),this.set_group_by(),this.set_rows_as_checked(),this.render_count()}set_group_by(){let e=this;e.page.add_inner_button(__("Group By"),async function(){let t=await C(),s=new frappe.ui.Dialog({title:__("Group By"),fields:[{label:__("Select Items"),fieldname:"items",fieldtype:"MultiSelect",options:t}],primary_action_label:__("Apply"),primary_action(i){localStorage.setItem("item_group_by",i.items),e.refresh(),s.hide(),setTimeout(()=>{localStorage.setItem("item_group_by","")},3e3)}});s.show()})}render_list(){function e(s){return s.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}this.$result.find(".list-row-container").remove();let t=localStorage.getItem("item_group_by")||"";if(this.data.length>0)if(t.length){let i=function(a,_,d=0){return d>=_.length?a:a.reduce((n,p)=>{let u=p[_[d]]||"No "+e(_[d]);return n[u]||(n[u]=[]),n[u].push(p),n},{})},l=function(a,_,d=0,o=5,n=""){for(let p in a){let u=n?`${n} - ${p}`:p,g=d>0?"d-none":"",w=n?`data-parent-name="${n}"`:"";if(this.$result.append(`
							<div class="list-row-container group-row ${g}" data-group-name="${u}" tabindex="1" ${w}>
								<div class="level list-row" style="padding-left: ${o}px;">
									<div class="list-group-title">${p}</div>
									<div>${a[p].length}</div>
								</div>
								<div class="list-row-border"></div>
							</div>
						`),d<_.length-1){let c=i(a[p],_,d+1);l.call(this,c,_,d+1,o+10,u)}else a[p].forEach(c=>{let f=this.get_list_row_html(c);this.$result.append(`<div class="grouped_rows d-none" data-group-by="${u}" data-parent-name="${u}" style="padding-left: ${o+20}px;">
									${f}
								</div>`)})}},s=t.replace(" ","").split(",");console.log(s);let r=i(this.data,s);l.call(this,r,s)}else{let s=0;for(let i of this.data)i._idx=s++,this.$result.append(this.get_list_row_html(i))}}render_count(){if(this.list_view_settings.disable_count)return;let e=this,t=this.get_count_element();this.get_count_str().then(s=>{t.html(`<span>${s}</span>`),this.count_upper_bound&&this.count_upper_bound==this.total_count&&(t.attr("title",__("The count shown is an estimated count. Click here to see the accurate count.")),t.tooltip({delay:{show:600,hide:100},trigger:"hover"}),t.on("click",()=>{e.count_upper_bound=0,t.off("click"),t.tooltip("disable"),e.freeze(),e.render_count()}))})}get_count_element(){return this.$result.find(".list-count")}get_header_html(){if(!this.columns)return;let e=this.columns[0].df,t=`
			<input class="level-item list-check-all" type="checkbox"
				title="${__("Select All")}">
			<span class="level-item" data-sort-by="${e.fieldname}"
				title="${__("Click to sort by {0}",[e.label])}">
				${__(e.label)}
			</span>
		`,s=this.columns.map(l=>{var _,d,o;let r=["list-row-col ellipsis",l.type=="Subject"?"list-subject level":"hidden-xs",l.type=="Tag"?"tag-col hide":"",frappe.model.is_numeric_field(l.df)?"text-right":""].join(" "),a="";if(l.type==="Subject")a=t;else{let n=(_=l.df)==null?void 0:_.fieldname,p=__(((d=l.df)==null?void 0:d.label)||l.type,null,(o=l.df)==null?void 0:o.parent),u=__("Click to sort by {0}",[p]);a=`<span ${n?`data-sort-by="${n}" title="${u}"`:""}>${p}</span>`}return`<div class="${r}">${a}</div>
			`}).join(""),i=`
			<span class="list-count"></span>
			<span class="level-item list-liked-by-me hidden-xs">
				<span title="${__("Liked by me")}">
					${frappe.utils.icon("es-solid-heart","sm","like-icon")}
				</span>
			</span>
		`;return this.get_header_html_skeleton(s,i)}get_header_html_skeleton(e="",t=""){return`
			<header class="level list-row-head text-muted">
				<div class="level-left list-header-subject">
					${e}
				</div>
				<div class="level-left checkbox-actions">
					<div class="level list-subject">
						<input class="level-item list-check-all" type="checkbox"
							title="${__("Select All")}">
						<span class="level-item list-header-meta"></span>
					</div>
				</div>
				<div class="level-right">
					${t}
				</div>
			</header>
		`}get_left_html(e){return this.columns.map(t=>this.get_column_html(t,e)).join("")}get_right_html(e){return this.get_meta_html(e)}get_list_row_html(e){return this.get_list_row_html_skeleton(this.get_left_html(e),this.get_right_html(e))}get_list_row_html_skeleton(e="",t=""){return`
			<div class="list-row-container" tabindex="1">
				<div class="level list-row">
					<div class="level-left ellipsis">
						${e}
					</div>
					<div class="level-right text-muted ellipsis">
						${t}
					</div>
				</div>
				<div class="list-row-border"></div>
			</div>
		`}get_column_html(e,t){var w,c,f;if(e.type==="Status"||((w=e.df)==null?void 0:w.options)=="Workflow State"){let b=((c=e.df)==null?void 0:c.options)=="Workflow State";return`
				<div class="list-row-col hidden-xs ellipsis">
					${this.get_indicator_html(t,b)}
				</div>
			`}if(e.type==="Tag"){let b=this.tags_shown?"":"hide",m=t._user_tags?this.get_tags_html(t._user_tags,2,!0):'<div class="tags-empty">-</div>';return`
				<div class="list-row-col tag-col ${b} hidden-xs ellipsis">
					${m}
				</div>
			`}let s=e.df||{},i=s.label,l=s.fieldname,r=this.link_field_title_fields[l],a=t[l]||"",_=r&&t[l+"_"+r]||a;(((f=frappe.boot)==null?void 0:f.translated_doctypes)||[]).includes(s.options)&&(_=__(_));let o=()=>s.fieldtype==="Code"?a:s.fieldtype==="Percent"?`<div class="progress" style="margin: 0px;">
						<div class="progress-bar progress-bar-success" role="progressbar"
							aria-valuenow="${a}"
							aria-valuemin="0" aria-valuemax="100" style="width: ${Math.round(a)}%;">
						</div>
					</div>`:frappe.format(a,s,null,t),n=()=>{let b,m;if(s.fieldtype=="Text Editor"||s.fetch_from&&["Text","Small Text"].includes(s.fieldtype)?m=strip_html(_):m=typeof _=="string"?frappe.utils.escape_html(_):_,s.fieldtype==="Rating"){let S=s.options||5;m=m*S}return s.fieldtype==="Image"?b=s.options?`<img src="${t[s.options]}"
					style="max-height: 30px; max-width: 100%;">`:`<div class="missing-image small">
						${frappe.utils.icon("restriction")}
					</div>`:s.fieldtype==="Select"?b=`<span class="filterable indicator-pill ${frappe.utils.guess_colour(m)} ellipsis"
					data-filter="${l},=,${a}">
					<span class="ellipsis"> ${__(m)} </span>
				</span>`:s.fieldtype==="Link"?b=`<a class="filterable ellipsis"
					data-filter="${l},=,${a}">
					${m}
				</a>`:["Text Editor","Text","Small Text","HTML Editor","Markdown Editor"].includes(s.fieldtype)?b=`<span class="ellipsis">
					${m}
				</span>`:b=`<a class="filterable ellipsis"
					data-filter="${l},=,${frappe.utils.escape_html(a)}">
					${o()}
				</a>`,`<span class="ellipsis"
				title="${__(i)}: ${frappe.utils.escape_html(m)}">
				${b}
			</span>`},u=["list-row-col ellipsis",{Subject:"list-subject level",Field:"hidden-xs"}[e.type],frappe.model.is_numeric_field(s)?"text-right":""].join(" "),g;return this.settings.formatters&&this.settings.formatters[l]&&e.type!=="Subject"?g=this.settings.formatters[l](a,s,t):g={Subject:this.get_subject_element(t,_).innerHTML,Field:n()}[e.type],`
			<div class="${u}">
				${g}
			</div>
		`}get_tags_html(e,t,s=!1){let i=l=>{let r="",a="";if(l)return s&&(r=frappe.get_palette(l),a=`background-color: var(${r[0]}); color: var(${r[1]})`),`<div class="tag-pill ellipsis" title="${l}" style="${a}">${l}</div>`};return e.split(",").slice(1,t+1).map(i).join("")}get_meta_html(e){let t="",s=null;this.settings.button&&this.settings.button.show(e)&&(s=`
				<span class="list-actions">
					<button class="btn btn-action btn-default btn-xs"
						data-name="${e.name}" data-idx="${e._idx}"
						title="${this.settings.button.get_description(e)}">
						${this.settings.button.get_label(e)}
					</button>
				</span>
			`);let i=comment_when(e.modified,!0),l="",r=e._assign?JSON.parse(e._assign):[];r.length&&(l=`<div class="list-assignments d-flex align-items-center">
					${frappe.avatar_group(r,3,{filterable:!0})[0].outerHTML}
				</div>`);let a=null;return this.list_view_settings&&!this.list_view_settings.disable_comment_count&&(a=`<span class="comment-count d-flex align-items-center">
				${frappe.utils.icon("es-line-chat-alt")}
				${e._comment_count>99?"99+":e._comment_count||0}
			</span>`),t+=`
			<div class="level-item list-row-activity hidden-xs">
				<div class="hidden-md hidden-xs">
					${s||l}
				</div>
				<span class="modified">${i}</span>
				${a||""}
				${a?'<span class="mx-2">\xB7</span>':""}
				<span class="list-row-like hidden-xs style="margin-bottom: 1px;">
					${this.get_like_html(e)}
				</span>
			</div>
			<div class="level-item visible-xs text-right">
				${this.get_indicator_html(e)}
			</div>
		`,t}get_count_str(){let e=this.data.length,t=this.data.uniqBy(s=>s.name).length;return frappe.db.count(this.doctype,{filters:this.get_filters_for_args(),limit:this.count_upper_bound}).then(s=>{this.total_count=s||e,this.count_without_children=t!==e?t:void 0;let i;this.total_count===this.count_upper_bound?i=`${format_number(this.total_count-1,null,0)}+`:i=format_number(this.total_count,null,0);let l=__("{0} of {1}",[format_number(e,null,0),i]);return this.count_without_children&&(l=__("{0} of {1} ({2} rows with children)",[t,i,e])),l})}get_form_link(e){return this.settings.get_form_link?this.settings.get_form_link(e):`/app/${encodeURIComponent(frappe.router.slug(frappe.router.doctype_layout||this.doctype))}/${encodeURIComponent(cstr(e.name))}`}get_seen_class(e){return(e._seen?JSON.parse(e._seen):[]).includes(frappe.session.user)?"":"bold"}get_like_html(e){let t=e._liked_by?JSON.parse(e._liked_by):[],s=t.includes(frappe.session.user),i=t.map(r=>frappe.user_info(r).fullname).join(", "),l=document.createElement("div");return l.appendChild(this._element_factory.get_like_element(e.name,s,t,i)),l.innerHTML}get_subject_element(e,t){let s=this._element_factory,i=document.createElement("div"),l=s.get_checkboxspan_element(),r=document.createElement("span"),a=this.get_seen_class(e);return a&&r.classList.add("level-item",a,"ellipsis"),i.appendChild(l).appendChild(s.get_checkbox_element(e.name)),i.appendChild(r).appendChild(s.get_link_element(e.name,this.get_form_link(e),this.get_subject_text(e,t))),i}get_subject_text(e,t){let s=this.columns[0].df,i=t||e[s.fieldname];if(this.settings.formatters&&this.settings.formatters[s.fieldname]){let l=this.settings.formatters[s.fieldname];i=l(i,s,e)}return i||(i=e.name),frappe.model.html_fieldtypes.includes(s.fieldtype)?frappe.utils.html2text(i):i}get_indicator_html(e,t){let s=frappe.get_indicator(e,this.doctype,t),l=[__("Document is in draft state"),__("Document has been submitted"),__("Document has been cancelled")][e.docstatus||0];return s?`<span class="indicator-pill ${s[1]} filterable no-indicator-dot ellipsis"
				data-filter='${s[2]}' title='${l}'>
				<span class="ellipsis"> ${__(s[0])}</span>
			</span>`:""}get_indicator_dot(e){let t=frappe.get_indicator(e,this.doctype);return t?`<span class='indicator ${t[1]}' title='${__(t[0])}'></span>`:""}get_image_url(e){let t=e.image?e.image:e[this.meta.image_field];return window.cordova&&!frappe.utils.is_url(t)&&(t=frappe.base_url+t),t||null}setup_events(){this.setup_filterable(),this.setup_sort_by(),this.setup_list_click(),this.setup_drag_click(),this.setup_tag_event(),this.setup_new_doc_event(),this.setup_check_events(),this.setup_like(),this.setup_realtime_updates(),this.setup_action_handler(),this.setup_keyboard_navigation()}setup_keyboard_navigation(){let e=()=>{this.$result.find(".list-row-container:first").focus()},t=()=>{$(document.activeElement).next().focus()},s=()=>{$(document.activeElement).prev().focus()},i=()=>$(document.activeElement).is(".list-row-container"),l=o=>{o.find("input[type=checkbox]").click()},r=()=>i()?$(document.activeElement):null,a=()=>this.page.wrapper.is(":visible"),_=()=>$(document.activeElement).is("input"),d=o=>{if(!a()||_())return!1;r()?o==="down"?t():s():e()};frappe.ui.keys.add_shortcut({shortcut:"down",action:()=>d("down"),description:__("Navigate list down",null,"Description of a list view shortcut"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"up",action:()=>d("up"),description:__("Navigate list up",null,"Description of a list view shortcut"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"shift+down",action:()=>{if(!a()||_())return!1;let o=r();l(o),t()},description:__("Select multiple list items",null,"Description of a list view shortcut"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"shift+up",action:()=>{if(!a()||_())return!1;let o=r();l(o),s()},description:__("Select multiple list items",null,"Description of a list view shortcut"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"enter",action:()=>{let o=r();return o?(o.find("a[data-name]")[0].click(),!0):!1},description:__("Open list item",null,"Description of a list view shortcut"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"space",action:()=>{let o=r();return o?(l(o),!0):!1},description:__("Select list item",null,"Description of a list view shortcut"),page:this.page})}setup_filterable(){this.$result.on("click",".filterable",e=>{if(e.metaKey||e.ctrlKey)return;e.stopPropagation();let i=$(e.currentTarget).attr("data-filter").split("|").map(l=>(l=l.split(","),l[2]==="Today"?l[2]=frappe.datetime.get_today():l[2]=="User"&&(l[2]=frappe.session.user),this.filter_area.remove(l[0]),[this.doctype,l[0],l[1],l.slice(2).join(",")]));this.filter_area.add(i)})}setup_sort_by(){this.$result.on("click","[data-sort-by]",e=>{let t=e.currentTarget.getAttribute("data-sort-by");if(!t)return;let s="asc";this.sort_by===t&&(s=this.sort_order==="asc"?"desc":"asc"),this.sort_selector.set_value(t,s),this.on_sort_change(t,s)})}setup_list_click(){this.$result.on("click",".list-row, .image-view-header, .file-header",e=>{let t=$(e.target);if((e.ctrlKey||e.metaKey)&&!t.is("a")){let r=$(e.currentTarget).find(".list-row-checkbox");r.prop("checked",!r.prop("checked")),e.preventDefault(),this.on_row_checked();return}if(t.hasClass("filterable")||t.hasClass("select-like")||t.hasClass("file-select")||t.hasClass("list-row-like")||t.is(":checkbox")){e.stopPropagation();return}if(t.is("a"))return;let i=$(e.currentTarget).find(".list-subject a").get(0);if(i)return frappe.set_route(i.pathname),!1})}setup_drag_click(){this.dragClick=!1,this.$result.on("mousedown",".list-row-checkbox",e=>{var t,s;(t=e.stopPropagation)==null||t.call(e),(s=e.preventDefault)==null||s.call(e),this.dragClick=!0,this.check=!e.target.checked}),$(document).on("mouseup",()=>{this.dragClick=!1}),this.$result.on("mousemove",".level.list-row",e=>{this.dragClick&&this.check_row_on_drag(e,this.check)})}check_row_on_drag(e,t=!0){$(e.target).find(".list-row-checkbox").prop("checked",t),this.on_row_checked()}setup_action_handler(){this.$result.on("click",".btn-action",e=>{let t=$(e.currentTarget),s=this.data[t.attr("data-idx")];return this.settings.button.action(s),e.stopPropagation(),!1})}setup_check_events(){this.$result.on("change","input[type=checkbox]",t=>{let s=$(t.currentTarget);if(s.is(".list-header-subject .list-check-all")){let i=this.$result.find(".checkbox-actions .list-check-all");i.prop("checked",s.prop("checked")),i.trigger("change")}else s.is(".checkbox-actions .list-check-all")?(this.$result.find(".list-header-subject .list-check-all").prop("checked",s.prop("checked")),this.$result.find(".list-row-checkbox").prop("checked",s.prop("checked"))):s.attr("data-parent")&&this.$result.find(`.${s.attr("data-parent")}`).find(".list-row-checkbox").prop("checked",s.prop("checked"));this.on_row_checked()}),this.$result.on("click",".list-row-checkbox",t=>{let s=$(t.currentTarget);if(t.shiftKey&&this.$checkbox_cursor&&!s.is(this.$checkbox_cursor)){let i=decodeURIComponent(this.$checkbox_cursor.data().name),l=decodeURIComponent(s.data().name),r=this.data.findIndex(p=>p.name===i),a=this.data.findIndex(p=>p.name===l),[_,d]=[r,a];_>d&&([_,d]=[d,_]);let n=this.data.slice(_+1,d).map(p=>p.name).map(p=>`.list-row-checkbox[data-name="${encodeURIComponent(p)}"]`).join(",");this.$result.find(n).prop("checked",!0)}this.$checkbox_cursor=s,this.update_checkbox(s)});let e=this;this.page.actions_btn_group.on("show.bs.dropdown",()=>{e.toggle_workflow_actions()})}setup_like(){this.$result.on("click",".like-action",e=>{let t=$(e.currentTarget),{doctype:s,name:i}=t.data();return frappe.ui.toggle_like(t,s,i),!1}),this.$result.on("click",".list-liked-by-me",e=>{let t=$(e.currentTarget);t.toggleClass("active"),t.hasClass("active")?this.filter_area.add(this.doctype,"_liked_by","like","%"+frappe.session.user+"%"):this.filter_area.remove("_liked_by")})}setup_new_doc_event(){this.$no_result.find(".btn-new-doc").click(()=>{this.settings.primary_action?this.settings.primary_action():this.make_new_doc()})}setup_tag_event(){this.tags_shown=!1,this.list_sidebar&&this.list_sidebar.parent.on("click",".list-tag-preview",()=>{this.tags_shown=!this.tags_shown,this.toggle_tags()})}setup_realtime_updates(){var e;this.pending_document_refreshes=[],!(((e=this.list_view_settings)==null?void 0:e.disable_auto_refresh)||this.realtime_events_setup)&&(frappe.realtime.doctype_subscribe(this.doctype),frappe.realtime.off("list_update"),frappe.realtime.on("list_update",t=>{(t==null?void 0:t.doctype)===this.doctype&&(this.$checks&&this.$checks.length||this.avoid_realtime_update()||(this.pending_document_refreshes.push(t),this.debounced_refresh()))}),this.realtime_events_setup=!0)}disable_realtime_updates(){frappe.realtime.doctype_unsubscribe(this.doctype),this.realtime_events_setup=!1}process_document_refreshes(){if(!this.pending_document_refreshes.length)return;let e=frappe.get_route()||[];if(!cur_list||e[0]!="List"||cur_list.doctype!=e[1]){this.pending_document_refreshes=[],this.disable_realtime_updates();return}let t=this.pending_document_refreshes.map(i=>i.name);if(this.pending_document_refreshes=this.pending_document_refreshes.filter(i=>t.indexOf(i.name)===-1),!t.length)return;let s=this.get_call_args();s.args.filters.push([this.doctype,"name","in",t]),s.args.start=0,frappe.call(s).then(({message:i})=>{if(!i)return;let l=frappe.utils.dict(i.keys,i.values);if(!(l&&l.length)){this.data=this.data.filter(r=>!t.includes(r.name));for(let r of t)this.$result.find(`.list-row-checkbox[data-name='${r.replace(/'/g,"\\'")}']`).closest(".list-row-container").remove();return}l.forEach(r=>{let a=this.data.findIndex(_=>_.name===r.name);a===-1?this.data.push(r):this.data[a]=r}),this.data.sort((r,a)=>{let _=r[this.sort_by]||"",d=a[this.sort_by]||"",o=0;return _>d&&(o=1),d>_&&(o=-1),this.sort_order==="desc"&&(o=-o),o}),this.$checks&&this.$checks.length&&this.set_rows_as_checked(),this.toggle_result_area(),this.render_list()})}avoid_realtime_update(){var e;return!!((e=this.filter_area)!=null&&e.is_being_edited()||this.disable_list_update)}set_rows_as_checked(){!this.$checks||!this.$checks.length||($.each(this.$checks,(e,t)=>{let s=$(t).attr("data-name");this.$result.find(`.list-row-checkbox[data-name='${s}']`).prop("checked",!0)}),this.on_row_checked())}on_row_checked(){this.$list_head_subject=this.$list_head_subject||this.$result.find("header .list-header-subject"),this.$checkbox_actions=this.$checkbox_actions||this.$result.find("header .checkbox-actions"),this.$checks=this.$result.find(".list-row-checkbox:checked"),this.$list_head_subject.toggle(this.$checks.length===0),this.$checkbox_actions.toggle(this.$checks.length>0),this.$checks.length===0?this.$list_head_subject.find(".list-check-all").prop("checked",!1):(this.$checkbox_actions.find(".list-header-meta").html(__("{0} items selected",[this.$checks.length])),this.$checkbox_actions.show(),this.$list_head_subject.hide()),this.update_checkbox(),this.toggle_actions_menu_button(this.$checks.length>0)}toggle_tags(){this.$result.find(".tag-col").toggleClass("hide");let e=this.tags_shown?__("Hide Tags"):__("Show Tags");this.list_sidebar.parent.find(".list-tag-preview").text(e)}get_checked_items(e){let t=Array.from(this.$checks||[]).map(s=>cstr(unescape($(s).data().name)));return e?t:this.data.filter(s=>t.includes(s.name))}clear_checked_items(){this.$checks&&this.$checks.prop("checked",!1),this.on_row_checked()}save_view_user_settings(e){return frappe.model.user_settings.save(this.doctype,this.view_name,e)}on_update(){}update_url_with_filters(){frappe.get_route_str()==this.page_name&&!this.report_name&&window.history.replaceState(null,null,this.get_url_with_filters())}get_url_with_filters(){let e=this.get_search_params(),t=window.location.href.replace(window.location.search,"");return e.size&&(t+="?"+e.toString()),t}get_search_params(){let e=new URLSearchParams;return this.get_filters_for_args().forEach(t=>{t[2]==="="?e.append(t[1],t[3]):e.append(t[1],JSON.stringify([t[2],t[3]]))}),e}get_menu_items(){let e=this.doctype,t=[];return frappe.model.can_import(e,null,this.meta)&&t.push({label:__("Import",null,"Button in list view menu"),action:()=>frappe.set_route("list","data-import",{reference_doctype:e}),standard:!0}),frappe.user_roles.includes("System Manager")&&t.push({label:__("User Permissions",null,"Button in list view menu"),action:()=>frappe.set_route("list","user-permission",{allow:e}),standard:!0}),frappe.user_roles.includes("System Manager")&&t.push({label:__("Role Permissions Manager",null,"Button in list view menu"),action:()=>frappe.set_route("permission-manager",{doctype:e}),standard:!0}),frappe.model.can_create("Custom Field")&&frappe.model.can_create("Property Setter")&&t.push({label:__("Customize",null,"Button in list view menu"),action:()=>{!this.meta||(this.meta.custom?frappe.set_route("form","doctype",e):this.meta.custom||frappe.set_route("form","customize-form",{doc_type:e}))},standard:!0,shortcut:"Ctrl+J"}),t.push({label:__("Toggle Sidebar",null,"Button in list view menu"),action:()=>this.toggle_side_bar(),condition:()=>!this.hide_sidebar,standard:!0,shortcut:"Ctrl+K"}),frappe.user.has_role("System Manager")&&frappe.boot.developer_mode===1&&t.push({label:__("Edit DocType",null,"Button in list view menu"),action:()=>frappe.set_route("form","doctype",e),standard:!0}),frappe.user.has_role("System Manager")&&this.get_view_settings&&t.push(this.get_view_settings()),t}get_view_settings(){return{label:__("List Settings",null,"Button in list view menu"),action:()=>this.show_list_settings(),standard:!0}}show_list_settings(){frappe.model.with_doctype(this.doctype,()=>{new y({listview:this,doctype:this.doctype,settings:this.list_view_settings,meta:frappe.get_meta(this.doctype)})})}get_workflow_action_menu_items(){let e=[],t=this;return frappe.model.has_workflow(this.doctype)&&frappe.workflow.get_all_transition_actions(this.doctype).forEach(i=>{e.push({label:__(i),name:i,action:()=>{t.disable_list_update=!0,frappe.xcall("frappe.model.workflow.bulk_workflow_approval",{docnames:this.get_checked_items(!0),doctype:this.doctype,action:i}).finally(()=>{t.disable_list_update=!1})},is_workflow_action:!0})}),e}toggle_workflow_actions(){if(!frappe.model.has_workflow(this.doctype))return;Object.keys(this.workflow_action_items).forEach(t=>{this.workflow_action_items[t].addClass("disabled")});let e=this.get_checked_items();frappe.xcall("frappe.model.workflow.get_common_transition_actions",{docs:e,doctype:this.doctype}).then(t=>{Object.keys(this.workflow_action_items).forEach(s=>{this.workflow_action_items[s].removeClass("disabled"),this.workflow_action_items[s].toggle(t.includes(s))})})}get_actions_menu_items(){let e=this.doctype,t=[],s=new v({doctype:this.doctype}),i=c=>c.fieldname&&frappe.model.is_value_type(c)&&c.fieldtype!=="Read Only"&&!c.hidden&&!c.read_only&&!c.is_virtual,l=c=>frappe.meta.get_docfields(c).some(f=>i(f)),r=c=>frappe.perm.has_perm(c,0,"submit"),a=()=>({label:__("Assign To",null,"Button in list view actions menu"),action:()=>{this.disable_list_update=!0,s.assign(this.get_checked_items(!0),()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})},standard:!0}),_=()=>({label:__("Apply Assignment Rule",null,"Button in list view actions menu"),action:()=>{this.disable_list_update=!0,s.apply_assignment_rule(this.get_checked_items(!0),()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})},standard:!0}),d=()=>({label:__("Add Tags",null,"Button in list view actions menu"),action:()=>{this.disable_list_update=!0,s.add_tags(this.get_checked_items(!0),()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})},standard:!0}),o=()=>({label:__("Print",null,"Button in list view actions menu"),action:()=>s.print(this.get_checked_items()),standard:!0}),n=()=>({label:__("Delete",null,"Button in list view actions menu"),action:()=>{let c=this.get_checked_items(!0).map(b=>b.toString()),f=__("Delete {0} item permanently?",[c.length],"Title of confirmation dialog");c.length>1&&(f=__("Delete {0} items permanently?",[c.length],"Title of confirmation dialog")),frappe.confirm(f,()=>{this.disable_list_update=!0,s.delete(c,()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})})},standard:!0}),p=()=>({label:__("Cancel",null,"Button in list view actions menu"),action:()=>{let c=this.get_checked_items(!0);c.length>0&&frappe.confirm(__("Cancel {0} documents?",[c.length],"Title of confirmation dialog"),()=>{this.disable_list_update=!0,s.submit_or_cancel(c,"cancel",()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})})},standard:!0}),u=()=>({label:__("Submit",null,"Button in list view actions menu"),action:()=>{let c=this.get_checked_items(!0);c.length>0&&frappe.confirm(__("Submit {0} documents?",[c.length],"Title of confirmation dialog"),()=>{this.disable_list_update=!0,s.submit_or_cancel(c,"submit",()=>{this.disable_list_update=!1,this.clear_checked_items(),this.refresh()})})},standard:!0}),g=()=>({label:__("Edit",null,"Button in list view actions menu"),action:()=>{let c={};frappe.meta.get_docfields(e).forEach(f=>{i(f)&&(c[f.label]=Object.assign({},f))}),this.disable_list_update=!0,s.edit(this.get_checked_items(!0),c,()=>{this.disable_list_update=!1,this.refresh()})},standard:!0}),w=()=>({label:__("Export",null,"Button in list view actions menu"),action:()=>{let c=this.get_checked_items(!0);s.export(e,c)},standard:!0});return l(e)&&!frappe.model.has_workflow(e)&&t.push(g()),t.push(w()),t.push(a()),t.push(_()),t.push(d()),frappe.model.can_print(e)&&t.push(o()),frappe.model.is_submittable(e)&&r(e)&&!frappe.model.has_workflow(e)&&t.push(u()),frappe.model.can_cancel(e)&&!frappe.model.has_workflow(e)&&t.push(p()),frappe.model.can_delete(e)&&!frappe.model.has_workflow(e)&&t.push(n()),t}parse_filters_from_route_options(){let e=[];for(let i in frappe.route_options){let l=null,r=frappe.route_options[i],a;if($.isArray(r)&&r[0].startsWith("[")&&r[0].endsWith("]")){a=[];for(var t=0;t<r.length;t++)a.push(JSON.parse(r[t]))}else typeof r=="string"&&r.startsWith("[")&&r.endsWith("]")&&(r=JSON.parse(r));if(i.includes(".")&&(l=i.split(".")[0],i=i.split(".")[1]),l||(l=frappe.meta.get_doctype_for_field(this.doctype,i)),l)if(a)for(var s=0;s<a.length;s++)$.isArray(a[s])?e.push([l,i,a[s][0],a[s][1]]):e.push([l,i,"=",a[s]]);else $.isArray(r)?e.push([l,i,r[0],r[1]]):e.push([l,i,"=",r])}return e}};frappe.get_list_view=h=>{let e=`List/${h}/List`;return frappe.views.list_view[e]};var k=class{constructor(e){this.templates={checkbox:this.create_checkbox_element(e),checkboxspan:this.create_checkboxspan_element(),link:this.create_link_element(e),like:this.create_like_element(e)}}create_checkbox_element(e){let t=document.createElement("input");return t.classList.add("list-row-checkbox"),t.type="checkbox",t.dataset.doctype=e,t}create_link_element(e){let t=document.createElement("a");return t.classList.add("ellipsis"),t.dataset.doctype=e,t}create_checkboxspan_element(){let e=document.createElement("span");return e.classList.add("level-item","select-like"),e}create_like_element(e){let t=document.createElement("span");return t.classList.add("like-action"),t.innerHTML=frappe.utils.icon("es-solid-heart","sm","like-icon"),t.dataset.doctype=e,t}get_checkbox_element(e){let t=this.templates.checkbox.cloneNode(!0);return t.dataset.name=e,t}get_checkboxspan_element(){return this.templates.checkboxspan.cloneNode(!0)}get_link_element(e,t,s){let i=this.templates.link.cloneNode(!0);return i.dataset.name=e,i.href=t,i.title=s,i.textContent=s,i}get_like_element(e,t,s,i){let l=this.templates.like.cloneNode(!0);l.dataset.name=e;let r=t?["liked-by","liked"]:["not-liked"];return l.classList.add(...r),l.setAttribute("data-liked-by",s||"[]"),l.setAttribute("title",i),l}};$(document).on("click",".group-row",h=>{let e=$(h.currentTarget).data("group-name");$(".grouped_rows").not(`[data-parent-name='${e}']`).addClass("d-none"),$(`[data-parent-name='${e}']`).toggleClass("d-none")});async function C(){return j(cur_list.fields)}function j(h){let e=[];return h.forEach(t=>{if(t.length>0){let s=t[0],i=s.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase());e.push({fieldname:s,value:s,label:i})}}),e}(function(){$(document).keydown(function(h){h.ctrlKey&&h.keyCode==13&&$(document.activeElement).parents("[data-fieldtype=Table]").find(".grid-add-row").click()})})();(function(){let h=()=>{let e=cur_frm.doc.doctype,t,s,i,l=frappe.get_list_view(e);if(l)t=l.get_filters_for_args(),s=l.sort_by,i=l.sort_order;else{let a=frappe.get_user_settings(e).List;a&&(t=a.filters,s=a.sort_by,i=a.sort_order)}let r={doctype:cur_frm.doc.doctype,docname:cur_frm.doc.name,filters:t,sort_order:i,sort_field:s};cur_frm.is_new()||frappe.call("idara_deva.events.item.get_cur_doc_index",r).then(a=>{if(a.message){let _="page-"+e.replace(/\s/g,"\\ "),d="#"+_,o=$(`
					<button class="text-muted btn btn-default pagination-btn icon-btn">
					${a.message}
					</button>
				`);$(".pagination-btn").remove(),$(d).find(".standard-actions").prepend(o)}})};frappe.router.on("change",function(){var e=frappe.get_route();if(e.length>2&&e[0]==="Form"&&e[1]!=e[2]){let t=setInterval(()=>{$(".page-icon-group:visible").length&&(h(),clearInterval(t))},500)}})})();var T=["Sales Order","Delivery Note","Purchase Order","Purchase Receipt"];for(let h of T)frappe.ui.form.on(h,{onload:function(e){e.savesubmit=function(t,s,i){var l=this;return new Promise(r=>{l.script_manager.trigger("before_submit").then(function(){frappe.validated=!0,l.save("Submit",function(a){a.exc?l.handle_save_fail(t,i):(frappe.utils.play_sound("submit"),s&&s(),l.script_manager.trigger("on_submit").then(()=>r(l)).then(()=>{if(frappe.route_hooks.after_submit){let _=frappe.route_hooks.after_submit;delete frappe.route_hooks.after_submit,_(l)}}))},t,()=>l.handle_save_fail(t,i),r)})})}}});var E=["Sales Order","Sales Invoice","Purchase Order","Purchase Invoice"];for(let h of E)frappe.ui.form.on(h,{custom_item_template:function(e){let t=e.doctype;["Sales Order","Sales Invoice"].includes(t)&&!e.doc.customer&&frappe.throw("Please select Customer first!"),["Purchase Order","Purchase Invoice"].includes(t)&&!e.doc.supplier&&frappe.throw("Please select Supplier first!"),frappe.prompt([{label:"Item Template",fieldname:"item_template",fieldtype:"Link",options:"Item",get_query:function(){return{filters:{has_variants:1}}}}],function(s){let i=s.item_template;i||frappe.throw("Please select Item Template first!");let l={query:"idara_deva.events.item_variants.get_variants",filters:{variant_of:i}},r=new frappe.ui.form.MultiSelectDialog({doctype:"Item",target:e,setters:{},add_filters_group:1,date_field:"",columns:["name","qty"],get_query:function(){return l},action:function(a){for(let _ of a){let d=e.add_child("items"),o=d.doctype,n=d.name,p=$(r.$parent[0]).find(`[data-variant_item_name="${_}"]`).val();frappe.model.set_value(o,n,"item_code",_),frappe.model.set_value(o,n,"qty",p),e.refresh_field("items")}$(r.$parent[0]).parents(".modal").click()}})})}});})();
//# sourceMappingURL=idara_deva.bundle.SDJ7AT7G.js.map
